---
title: "PQ Challenge"
author: "Anil Goyal"
date: "2024-04-10"
output: html_document
---
## Load libraries
```{r}
library(readxl)
library(tidyverse)
```


## PQ Challenge 169: Extract specific strings
It combines both lookahead and lookbehind in one string
```{r}
df <- read_xlsx("PQ/PQ_Challenge_169.xlsx", range = cell_cols(LETTERS[1]))
df %>% 
  mutate(Codes = map_chr(String, ~ str_extract_all(.x, pattern = "(?<=\\b)[A-Z]+\\d+[A-Z0-9]+(?=\\b)") %>% 
                           unlist() %>% 
                           str_c(collapse = ", ")))
```


## PQ Challenge 170: Weekdays and Weekends
```{r}
df <- read_xlsx("PQ/PQ_Challenge_170.xlsx", range = cell_cols(LETTERS[1:3]))

df %>% 
  group_by(`Day Type` = c("Weekday", "Weekend")[1 + weekdays(Date, abbreviate = TRUE) %in% c("Sat", "Sun")], Item) %>% 
  summarise(Sales = sum(Sale), .groups = 'drop') %>% 
  summarise(`Total Sales` = sum(Sales), 
            `Highest Selling Item` = str_c(Item[Sales == max(Sales)], collapse = ", "),
            `Lowest Selling Item` = str_c(Item[Sales == min(Sales)], collapse = ", "),
            .by = `Day Type`)
```


## PQ Challenge 171

```{r}
df <- read_xlsx("PQ/PQ_Challenge_171.xlsx", range = cell_cols(LETTERS[1:6]))

split.default(1:6, (0:5 %% 3) + 1) %>% 
  map_dfr(~df %>% 
        select(all_of(.x)) %>% 
        rename_with(~ paste0("Col", 1:2))) %>% 
  filter(if_any(everything(), ~!is.na(.)))
```


## PQ Challenge 172

```{r}
library(readxl)
library(tidyverse)

df <- read_xlsx("PQ/PQ_Challenge_172.xlsx", range = cell_cols(LETTERS[1:6]))
df %>% 
  janitor::clean_names() %>% 
  separate(share_percent, into = paste0("Share", 1:2), convert = TRUE) %>% 
  pivot_longer(cols = c(starts_with("agent"), starts_with("Share")), 
               names_pattern = "(\\D*)(\\d)",
               names_to = c(".value", "num"),
               values_drop_na = TRUE) %>% 
  complete(fill = list(Share = 100)) %>% 
  mutate(amt = amount * commission_percent * Share/10000) %>% 
  summarise(Commission = sum(amt), .by = agent) %>% 
  janitor::adorn_totals()
```

